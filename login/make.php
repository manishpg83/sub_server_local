<?php
header('Content-Type: text/plain; charset=utf-8');
$data = file_get_contents('/home/amx/Z/portal/PgAvfHpU.php');
$link = mysqli_connect('localhost','amx',$data,'amx_portal');

$tabs = array('foods','food','pollen','environmental','chemicals','panels','','');
$groups = array();
for($tab=0;$tab<5;$tab++){
	echo "Tab=$tab\n";
	
	//if($tab == 1){break;}
	
	
  $label = 1;
  $allergens = array();
  $file = $tabs[$tab] . '.txt'; echo "$file\n";
  $lines = explode("\n",file_get_contents($file));
  var_export($lines);
  foreach($lines as $line){
    $type = 0;
    $code = trim(substr($line,0,4));
    $description = trim(substr($line,5));
    if(strlen($code) == 0){$type = 5; $code = "L$label";$label++;$group = substr($line,5,1);$description = substr($description,1);} //continue;}
    $allergens[$code] = array($type,0,0,0,$description);
	$groups[$group][] = $code;
  }//var_export($groups );exit; 
  $jsn = json_encode($allergens);
  $file = $tabs[$tab] . 'Base.jsn';
  file_put_contents($file,$jsn);
}
exit;

$panels = array('100T'=> 'TIgE Dil','101T'=> 'TIgE Hi Dil','200-PD'=> 'Pediatric Panel','220'=> 'Peanut Risk ','252'=> 'Mold  ','255'=> 'IBS','255-1'=> 'G4 only','255-2'=> 'E only','900'=> 'Food','900-5'=> 'E only','900-6'=> 'G4 only','900-7'=> 'E & G','950'=> '30 E & G4 ','950-3'=> '30 E only','950-1'=> '15 E & G4','950-2'=> '15 E & G4 f/up');
$ids = array ( '100T' => '11', '101T' => '152', '200-PD' => '70', 220 => '305', 252 => '19', 255 => '167', '255-1' => '218', '255-2' => '237', 900 => '128', '900-5' => '154', '900-6' => '160', '900-7' => '300', 950 => '360', '950-3' => '369', '950-1' => '361', '950-2' => '362');
$selected = array();
foreach($panels as $panel){$selected[$panel][0] = 0;}
$sql = "SELECT `rec`,`description`,`panel` FROM `clientPanels` WHERE `client` = 200014 ORDER BY `clientPanels`.`panel` ASC";
$results = mysqli_query($link,$sql);
while (list($rec,$description,$panel) = mysqli_fetch_array($results, MYSQLI_NUM)){
  $selected[$panel][0] = 0;
}
$file = $tabs[5] . 'Base.jsn';
$jsn = json_encode($selected);
file_put_contents($file,$jsn);exit;


$environmental = array('D'=>array(0=>'D002',1=>'D001',2=>'EZ06',3=>'HZ05',4=>'H010',5=>'H001',6=>'H002',),'I'=>array(0=>'I010',1=>'I070',2=>'I016',3=>'IZ17',4=>'I206',5=>'I006',6=>'I011',7=>'I012',8=>'I001',9=>'I002',10=>'I005',11=>'I014',12=>'I007',13=>'I004',14=>'I003',),'M'=>array(0=>'M048',1=>'M026',2=>'M006',3=>'M018',4=>'M003',5=>'M021',6=>'M019',7=>'M022',8=>'M023',9=>'M012',10=>'M039',11=>'M042',12=>'M031',13=>'M033',14=>'M025',15=>'M045',16=>'M002',17=>'M016',18=>'M014',19=>'M037',20=>'M009',21=>'M030',22=>'M050',23=>'M008',24=>'M062',25=>'M035',26=>'M034',27=>'M052',28=>'M036',29=>'MZ02',30=>'M049',31=>'M040',32=>'M004',33=>'M047',34=>'M001',35=>'M013',36=>'M046',37=>'M011',38=>'M027',39=>'M038',40=>'M020',41=>'M063',42=>'M061',43=>'M041',44=>'M010',45=>'M024',46=>'MZ15',47=>'M044',48=>'M043',49=>'M032',),'E'=>array(0=>'E001',1=>'E103',2=>'E004',3=>'E005',4=>'EZ04',5=>'EZ07',6=>'E008',7=>'E085',8=>'E086',9=>'E070',10=>'EZ12',11=>'E009',12=>'E100',13=>'E101',14=>'E013',15=>'E011',16=>'E012',17=>'E010',18=>'E071',19=>'E072',20=>'E111',21=>'E015',22=>'E102',23=>'E082',24=>'E073',25=>'E014',),'O'=>array(0=>'S037',1=>'S042',2=>'K001',3=>'K082',4=>'K002',5=>'S046'));


$pollen = array('G'=>array(0=>'G017',1=>'G002',2=>'G022',3=>'G026',4=>'G025',5=>'G024',6=>'GZ08',7=>'G010',8=>'G008',9=>'G004',10=>'G014',11=>'G003',12=>'G009',13=>'G005',14=>'G021',15=>'G023',16=>'G006',17=>'G013',18=>'G015',),'T'=>array(0=>'T019',1=>'T100',2=>'T101',3=>'T153',4=>'T002',5=>'T022',6=>'T102',7=>'T103',8=>'T015',9=>'T104',10=>'T155',11=>'T005',12=>'T003',13=>'T146',14=>'T021',15=>'T006',16=>'T105',17=>'T011',18=>'T014',19=>'T132',20=>'T106',21=>'T023',22=>'T008',23=>'T107',24=>'T108',25=>'T018',26=>'T154',27=>'T131',28=>'T137',29=>'T149',30=>'T133',31=>'T109',32=>'T012',33=>'T148',34=>'T017',35=>'T004',36=>'T110',37=>'T111',38=>'T001',39=>'T138',40=>'T020',41=>'T141',42=>'T112',43=>'T144',44=>'T143',45=>'T151',46=>'T134',47=>'T139',48=>'T114',49=>'T115',50=>'T007',51=>'T009',52=>'T116',53=>'T117',54=>'T118',55=>'T119',56=>'T072',57=>'T145',58=>'T120',59=>'T142',60=>'T121',61=>'T122',62=>'T147',63=>'T123',64=>'T016',65=>'TZ01',66=>'T124',67=>'T125',68=>'T130',69=>'T126',70=>'T140',71=>'TZ13',72=>'TZ09',73=>'T150',74=>'T127',75=>'T010',76=>'T013',77=>'T152',78=>'T136',79=>'T128',),'W'=>array(0=>'W100',1=>'W115',2=>'W116',3=>'W107',4=>'W101',5=>'W013',6=>'W102',7=>'W123',8=>'W125',9=>'W104',10=>'W126',11=>'W121',12=>'W118',13=>'W117',14=>'W010',15=>'W015',16=>'W021',17=>'W016',18=>'W105',19=>'W006',20=>'W020',21=>'W106',22=>'W019',23=>'W014',24=>'W119',25=>'W122',26=>'W009',27=>'W004',28=>'W001',29=>'W124',30=>'W003',31=>'WZ16',32=>'W109',33=>'W002',34=>'W111',35=>'W018',36=>'W112',37=>'W114',38=>'W011',39=>'W113',40=>'WZ10',41=>'W007',42=>'W005'));
$foods = array('A'=>array(0=>'F027',1=>'F037',2=>'F083',3=>'F106',4=>'F001',5=>'F395',6=>'F357',7=>'F245',8=>'F075',9=>'F133',10=>'F158',11=>'F026',12=>'F416',13=>'F284',14=>'F410',),'D'=>array(0=>'F376',1=>'F307',2=>'F081',3=>'F411',4=>'F379',5=>'F082',6=>'F034',7=>'F380',8=>'F117',9=>'F002',10=>'F078',11=>'F076',12=>'F077',13=>'F358',14=>'F236',15=>'F147',16=>'F319',),'F'=>array(0=>'F032',1=>'F101',2=>'F378',3=>'F306',4=>'F003',5=>'F107',6=>'F311',7=>'F312',8=>'F119',9=>'F111',10=>'F120',11=>'F041',12=>'F353',13=>'F123',14=>'F337',15=>'F118',16=>'F361',17=>'F204',18=>'F040',19=>'F121',),'U'=>array(0=>'F049',1=>'F138',2=>'F092',3=>'F139',4=>'F288',5=>'F029',6=>'F305',7=>'F100',8=>'F104',9=>'F105',10=>'F259',11=>'F418',12=>'F209',13=>'F087',14=>'F153',15=>'F208',16=>'F134',17=>'F351',18=>'F132',19=>'F124',20=>'F342',21=>'F033',22=>'F127',23=>'F095',24=>'F094',25=>'F210',26=>'F128',27=>'F021',28=>'F115',29=>'F129',30=>'F044',31=>'F155',32=>'F025',33=>'F329',34=>'F406',35=>'F404',36=>'F407',),'N'=>array(0=>'F006',1=>'F304',2=>'F102',3=>'F008',4=>'FZ11',5=>'F125',6=>'F090',7=>'F157',8=>'F007',9=>'F369',10=>'F009',11=>'F005',12=>'F131',13=>'F004',14=>'F079',),'L'=>array(0=>'F356',1=>'F417',2=>'F300',3=>'F301',4=>'F302',5=>'F303',6=>'F015',7=>'F154',8=>'F022',9=>'F126',10=>'F355',11=>'F142',12=>'F012',13=>'F013',14=>'F359',15=>'F360',16=>'F372',17=>'F014',),'M'=>array(0=>'F019',1=>'F364',2=>'F365',3=>'F366',4=>'FZ03',5=>'F109',6=>'F110',),'S'=>array(0=>'F373',1=>'F374',2=>'F343',3=>'F347',4=>'F159',5=>'F308',6=>'F146',7=>'F309',8=>'F140',9=>'F141',10=>'F341',11=>'F143',12=>'F345',13=>'F392',14=>'F089',15=>'F148',16=>'F283',17=>'F112',18=>'F144',19=>'F263',20=>'F313',21=>'F314',22=>'F011',23=>'F150',24=>'F137',25=>'F352',26=>'F349',27=>'F151',28=>'F010',29=>'F316',30=>'F340',31=>'F409',32=>'F156',33=>'F016',),'H'=>array(0=>'F207',1=>'F310',2=>'F339',3=>'F354',4=>'F381',5=>'F080',6=>'F136',7=>'F393',8=>'F394',9=>'F290',10=>'F396',11=>'F398',12=>'F338',13=>'F024',14=>'F116',15=>'F247',16=>'F350',17=>'F388',),'T'=>array(0=>'F020',1=>'F018',2=>'F202',3=>'F103',4=>'F093',5=>'F036',6=>'F221',7=>'F348',8=>'F017',9=>'F363',10=>'FZ13',11=>'F201',12=>'F114',13=>'F203',14=>'F130',15=>'F256',16=>'F317',17=>'FZ16',),'V'=>array(0=>'F122',1=>'F135',2=>'F096',3=>'F152',4=>'F145',5=>'F260',6=>'F216',7=>'F031',8=>'F291',9=>'F085',10=>'F023',11=>'F030',12=>'F244',13=>'F108',14=>'F382',15=>'F047',16=>'F387',17=>'F370',18=>'F414',19=>'F215',20=>'F212',21=>'F028',22=>'F048',23=>'F054',24=>'F035',25=>'F115',26=>'F149',27=>'F415',28=>'F214',29=>'F346',30=>'F344',),'Y'=>array(0=>'F318',1=>'F045',2=>'F408',));
$data = file_get_contents('/home/amx/Z/portal/PgAvfHpU.php');
$link = mysqli_connect('localhost','amx',$data,'amx_portal');
foreach($foods as $group => $codes){
  foreach($codes as $code){
    $sql = "UPDATE `AllergyTests2` SET `Group`= '$group' WHERE `Code` LIKE '$code' ";
	mysqli_query($link,$sql);
  }
}

exit;
$foods = array('A'=>array(0=>'F027',1=>'F037',2=>'F083',3=>'F106',4=>'F001',5=>'F395',6=>'F357',7=>'F245',8=>'F075',9=>'F133',10=>'F158',11=>'F026',12=>'F416',13=>'F284',14=>'F410',),'R'=>array(0=>'F376',1=>'F307',2=>'F081',3=>'F411',4=>'F379',5=>'F082',6=>'F034',7=>'F380',8=>'F117',9=>'F002',10=>'F078',11=>'F076',12=>'F077',13=>'F358',14=>'F236',15=>'F147',16=>'F319',),'F'=>array(0=>'F032',1=>'F101',2=>'F378',3=>'F306',4=>'F003',5=>'F107',6=>'F311',7=>'F312',8=>'F119',9=>'F111',10=>'F120',11=>'F041',12=>'F353',13=>'F123',14=>'F337',15=>'F118',16=>'F361',17=>'F204',18=>'F040',19=>'F121',),'U'=>array(0=>'F049',1=>'F138',2=>'F092',3=>'F139',4=>'F288',5=>'F029',6=>'F305',7=>'F100',8=>'F104',9=>'F105',10=>'F259',11=>'F418',12=>'F209',13=>'F087',14=>'F153',15=>'F208',16=>'F134',17=>'F351',18=>'F132',19=>'F124',20=>'F342',21=>'F033',22=>'F127',23=>'F095',24=>'F094',25=>'F210',26=>'F128',27=>'F021',28=>'F115',29=>'F129',30=>'F044',31=>'F155',32=>'F025',33=>'F329',34=>'F406',35=>'F404',36=>'F407',),'K'=>array(0=>'F006',1=>'F304',2=>'F102',3=>'F008',4=>'FZ11',5=>'F125',6=>'F090',7=>'F157',8=>'F007',9=>'F369',10=>'F009',11=>'F005',12=>'F131',13=>'F004',14=>'F079',),'L'=>array(0=>'F356',1=>'F417',2=>'F300',3=>'F301',4=>'F302',5=>'F303',6=>'F015',7=>'F154',8=>'F022',9=>'F126',10=>'F355',11=>'F142',12=>'F012',13=>'F013',14=>'F359',15=>'F360',16=>'F372',17=>'F014',),'O'=>array(0=>'F019',1=>'F364',2=>'F365',3=>'F366',4=>'FZ03',5=>'F109',6=>'F110',),'S'=>array(0=>'F373',1=>'F374',2=>'F343',3=>'F347',4=>'F159',5=>'F308',6=>'F146',7=>'F309',8=>'F140',9=>'F141',10=>'F341',11=>'F143',12=>'F345',13=>'F392',14=>'F089',15=>'F148',16=>'F283',17=>'F112',18=>'F144',19=>'F263',20=>'F313',21=>'F314',22=>'F011',23=>'F150',24=>'F137',25=>'F352',26=>'F349',27=>'F151',28=>'F010',29=>'F316',30=>'F340',31=>'F409',32=>'F156',33=>'F016',),'H'=>array(0=>'F207',1=>'F310',2=>'F339',3=>'F354',4=>'F381',5=>'F080',6=>'F136',7=>'F393',8=>'F394',9=>'F290',10=>'F396',11=>'F398',12=>'F338',13=>'F024',14=>'F116',15=>'F247',16=>'F350',17=>'F388',),'N'=>array(0=>'F020',1=>'F018',2=>'F202',3=>'F103',4=>'F093',5=>'F036',6=>'F221',7=>'F348',8=>'F017',9=>'F363',10=>'FZ13',11=>'F201',12=>'F114',13=>'F203',14=>'F130',15=>'F256',16=>'F317',17=>'FZ16',),'V'=>array(0=>'F122',1=>'F135',2=>'F096',3=>'F152',4=>'F145',5=>'F260',6=>'F216',7=>'F031',8=>'F291',9=>'F085',10=>'F023',11=>'F030',12=>'F244',13=>'F108',14=>'F382',15=>'F047',16=>'F387',17=>'F370',18=>'F414',19=>'F215',20=>'F212',21=>'F028',22=>'F048',23=>'F054',24=>'F035',25=>'F115',26=>'F149',27=>'F415',28=>'F214',29=>'F346',30=>'F344',),'Y'=>array(0=>'F318',1=>'F045',2=>'F408',),);
foreach($foods as $group => $codes){
  foreach($codes as $code){
    $sql = "UPDATE `AllergyTests2` SET `Group`= '$group' WHERE `Code` LIKE '$code' ";
	mysqli_query($link,$sql);
  }
}

exit;
?>